# Enforce Promises in Vue functions with specified syntax to be handled appropriately (`no-restricted-vue-unhandled-promises`)

We can use asynchronous functions in many scenarios in Vue, but these asynchronous functions tend to generate floating promises, such as lifecycles, watchers, etc.

As a complement to [`no-restricted-floating-promises`](../rules/no-restricted-floating-promises), this rule checks for floating promises caused by using await expressions in specific Vue functions.

## Options

This rule has a list of string or object options. Each option can be:

- An [AST Selector](https://eslint.org/docs/developer-guide/selectors) string
- An object with the following properties:
  - `type`: Predefined selector, such as `vuex-action`, `element-message-box` or `vant-dialog`
  - `selector`: An [AST Selector](https://eslint.org/docs/developer-guide/selectors) string
  - `paths`: An array of [ignore](https://www.npmjs.com/package/ignore) pattern, meaning that promises generated by functions imported from specified modules will be checked
  - `message`: Custom reporting message

## Fail

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  async created() {
    await foo()
  },
}
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  watch: {
    async bar() {
      await foo()
    },
  },
}
```

```vue
<template>
  <span @click="bar"></span>
</template>

<script>
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  methods: {
    async bar() {
      await foo()
    },
  },
}
</script>
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  setup() {
    onMounted(async () => {
      await foo()
    })
  },
}
```

```vue
<script setup>
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
watch(() => props.bar, async () => {
  await foo()
})
</script>
```

```vue
<script setup>
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
async function bar() {
  await foo()
}
</script>

<template>
  <span @click="bar"></span>
</template>
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", { "type": "vuex-action" }] */
export default {
  async created() {
    await this.$store.dispatch('submit')
  },
}
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", { "type": "element-message-box" }] */
export default {
  async created() {
    await this.$confirm({})
  },
}
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", { "type": "vant-dialog" }] */
export default {
  async created() {
    await this.$dialog.confirm({})
  },
}
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", { "paths": ["foo"] }] */
import { foo } from 'foo'
export default {
  async created() {
    await foo()
  },
}
```

## Pass

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  async created() {
    await bar()
  },
}
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  created() {
    return bar()
  },
}
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  async created() {
    try {
      await foo()
    } catch {}
  },
}
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
export default {
  async created() {
    try {
      await Promise.all([
        foo(),
      ])
    } catch {}
  },
}
```

```vue
<script setup>
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", "CallExpression[callee.name='foo']"] */
watchEffect(async () => {
  try {
    await foo()
  } catch {}
})
</script>
```

```js
/* eslint galaxy/no-restricted-vue-unhandled-promises: ["error", { "paths": ["foo"] }] */
import { foo } from 'bar'
export default {
  async created() {
    await foo()
  },
}
```
